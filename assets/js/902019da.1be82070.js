"use strict";(self.webpackChunknear_wiki=self.webpackChunknear_wiki||[]).push([[7395],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return d}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var i=n.createContext({}),p=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(i.Provider,{value:t},e.children)},k={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(a),d=o,m=u["".concat(i,".").concat(d)]||u[d]||k[d]||r;return a?n.createElement(m,l(l({ref:t},c),{},{components:a})):n.createElement(m,l({ref:t},c))}));function d(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,l=new Array(r);l[0]=u;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,l[1]=s;for(var p=2;p<r;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},6422:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return i},metadata:function(){return p},toc:function(){return c},default:function(){return u}});var n=a(7462),o=a(3366),r=(a(7294),a(3905)),l=["components"],s={id:"delegation",title:"Token Delegation",sidebar_label:"Token Delegation"},i="Token Delegation",p={unversionedId:"getting-started/near-token/delegation",id:"getting-started/near-token/delegation",isDocsHomePage:!1,title:"Token Delegation",description:"Overview",source:"@site/docs/getting-started/near-token/token-delegation.md",sourceDirName:"getting-started/near-token",slug:"/getting-started/near-token/delegation",permalink:"/wiki/docs/getting-started/near-token/delegation",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/getting-started/near-token/token-delegation.md",tags:[],version:"current",frontMatter:{id:"delegation",title:"Token Delegation",sidebar_label:"Token Delegation"},sidebar:"tutorialSidebar",previous:{title:"Token Custody",permalink:"/wiki/docs/getting-started/near-token/token-custody"},next:{title:"What's an NFT?",permalink:"/wiki/docs/getting-started/near-token/whats-an-nft"}},c=[{value:"Overview",id:"overview",children:[{value:"Viewing and Choosing Validators",id:"viewing-and-choosing-validators",children:[],level:3}],level:2},{value:"GUI-based delegation (via a website or app)",id:"gui-based-delegation-via-a-website-or-app",children:[],level:2},{value:"CLI-based delegation",id:"cli-based-delegation",children:[],level:2},{value:"1. Lockup Contracts Delegation",id:"1-lockup-contracts-delegation",children:[{value:"a. Set the staking pool",id:"a-set-the-staking-pool",children:[],level:3},{value:"b. Deposit and stake the tokens",id:"b-deposit-and-stake-the-tokens",children:[],level:3},{value:"c. Measure the rewards",id:"c-measure-the-rewards",children:[],level:3}],level:2},{value:"Unstake and withdraw your lockup tokens",id:"unstake-and-withdraw-your-lockup-tokens",children:[{value:"a. Unstake the tokens",id:"a-unstake-the-tokens",children:[],level:3},{value:"b. Withdraw the tokens",id:"b-withdraw-the-tokens",children:[],level:3},{value:"c. Change staking pools",id:"c-change-staking-pools",children:[],level:3}],level:2},{value:"Staking Pool Delegation",id:"staking-pool-delegation",children:[],level:2},{value:"Additional links",id:"additional-links",children:[],level:2},{value:"Fun Facts",id:"fun-facts",children:[],level:2}],k={toc:c};function u(e){var t=e.components,a=(0,o.Z)(e,l);return(0,r.kt)("wrapper",(0,n.Z)({},k,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"token-delegation"},"Token Delegation"),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"To learn more about what validation and delegation are, please see the ",(0,r.kt)("a",{parentName:"p",href:"/wiki/docs/validator/staking-overview"},"Validation docs")," and ",(0,r.kt)("a",{parentName:"p",href:"/wiki/docs/validator/validator-support/faq"},"validation FAQ"),". The current page will describe the mechanics of participating in delegation."),(0,r.kt)("p",null,'At a high level, anyone can delegate their tokens to a staking pool which is run by a validator. This is usually just called "Staking". This is possible even if your tokens are in a lockup contract ',"(","as most tokens are during the network's early release",")",". Delegating to a staking pool allows you to receive some staking rewards ","(","which will activate as part of the Phase II rollout and depend on the exact fees charged by the validator",")"," and to participate in protocol governance by adding weight to the vote of the validator whose pool you have delegated to."),(0,r.kt)("p",null,"You can participate in delegation by using a website ","(","GUI",")",", using the ",(0,r.kt)("inlineCode",{parentName:"p"},"view")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"call")," methods of the command-line interface ","(","CLI",")"," or via sending RPC calls directly. These are described below."),(0,r.kt)("p",null,"Reminder: If you haven't already, evaluate your token custody options from ",(0,r.kt)("a",{parentName:"p",href:"/wiki/docs/getting-started/near-token/token-custody"},"this documentation page"),"."),(0,r.kt)("h3",{id:"viewing-and-choosing-validators"},"Viewing and Choosing Validators"),(0,r.kt)("p",null,"During early days, the staking pool contracts ","(",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near/core-contracts/tree/master/staking-pool"},"code"),")"," allow validators to select what fee they will charge on rewards earned by pools they run. In the future, updated versions of the staking pool contracts may include more parameters ","(","which is one of the nice features enabled by NEAR's contract-based delegation",")","."),(0,r.kt)("p",null,"Several community-run lists of validators list who they are, how much stake they have, what their vote was ",(0,r.kt)("a",{parentName:"p",href:"https://near.org/blog/mainnet-phase-i/"},"for the Phase II transition")," and more. These can be helpful for selecting where to delegate your tokens. As always, do your own diligence."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Operator"),(0,r.kt)("th",{parentName:"tr",align:"left"},"URL ","(","to copy and paste",")"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"NEAR Explorer"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://explorer.near.org/nodes/validators"},"https://explorer.near.org/nodes/validators"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"DokiaCapital"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://staking.dokia.cloud/staking/near/validators"},"https://staking.dokia.cloud/staking/near/validators"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Stardust NEAR Pool"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://near-staking.com/"},"https://near-staking.com/"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"YOUR OPERATOR"),(0,r.kt)("td",{parentName:"tr",align:"left"},"ADD YOUR LINK HERE")))),(0,r.kt)("h2",{id:"gui-based-delegation-via-a-website-or-app"},"GUI-based delegation ","(","via a website or app",")"),(0,r.kt)("p",null,"Disclaimer: the list below is community-maintained, and is not an endorsement by NEAR to use any of them. Do your own research before staking your funds with them!"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Provider"),(0,r.kt)("th",{parentName:"tr",align:"left"},"URL ","(","to copy and paste",")"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Added on"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"NEAR Wallet"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://wallet.near.org"},"https://wallet.near.org")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Oct 11 2020")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"DokiaCapital"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://staking.dokia.cloud"},"https://staking.dokia.cloud")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Sept 11 2020")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Moonlet Wallet"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"https://moonlet.io/near-staking"},"https://moonlet.io/near-staking")),(0,r.kt)("td",{parentName:"tr",align:"left"},"15 Oct 2020")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"add here"),(0,r.kt)("td",{parentName:"tr",align:"left"},"your link"),(0,r.kt)("td",{parentName:"tr",align:"left"},"first come, first serve")))),(0,r.kt)("h2",{id:"cli-based-delegation"},"CLI-based delegation"),(0,r.kt)("p",null,"Disclaimer: the documentation below refers to the Github repository ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near/core-contracts/"},"Core Contracts"),". Always check the source of the smart contract before delegating your funds to it!"),(0,r.kt)("p",null,"You can use ",(0,r.kt)("inlineCode",{parentName:"p"},"near-cli")," with NEAR Core Contracts to delegation via:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Lockup Contract"),(0,r.kt)("li",{parentName:"ol"},"Staking Pool")),(0,r.kt)("p",null,"Before starting, make sure you are running the latest version of ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near/near-cli"},"near-cli"),", you are familiar with ",(0,r.kt)("a",{parentName:"p",href:"https://docs.near.org/docs/concepts/gas"},"gas fees")," and you are sending transactions to the correct NEAR network. By default ",(0,r.kt)("inlineCode",{parentName:"p"},"near-cli")," is configured to work with TestNet. You can change the network to MainNet by issuing the command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export NODE_ENV=mainnet\n")),(0,r.kt)("p",null,"It will also be helpful to set some variables, which we will use in commands below. On Linux/macOS/Unix:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"export ACCOUNT_ID=#your account id\nexport LOCKUP_ID=#your lockup contract address\nexport POOL_ID=#your staking pool\n")),(0,r.kt)("p",null,"If you're using Windows, you can replace all the ",(0,r.kt)("inlineCode",{parentName:"p"},"export")," commands with ",(0,r.kt)("inlineCode",{parentName:"p"},"set"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"set ACCOUNT_ID=#your account id\n")),(0,r.kt)("p",null,"You can check that you set these correctly with ",(0,r.kt)("inlineCode",{parentName:"p"},"echo"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"echo $ACCOUNT_ID\n")),(0,r.kt)("p",null,"Note that when you set variables with ",(0,r.kt)("inlineCode",{parentName:"p"},"export")," you do not prefix them with the dollar sign, but when you use them elsewhere such as with ",(0,r.kt)("inlineCode",{parentName:"p"},"echo"),", you need the dollar sign."),(0,r.kt)("p",null,"If you're using a secondary account on a Ledger Nano device, you will also want to create an HD_PATH variable. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"export HD_PATH=\"account 44'/397'/0'/0'/2'\"\n")),(0,r.kt)("p",null,"The default HD path for the NEAR app on Ledger devices is ",(0,r.kt)("inlineCode",{parentName:"p"},"44'/397'/0'/0'/1'"),". See more info on using ",(0,r.kt)("inlineCode",{parentName:"p"},"near-cli")," with Ledger ",(0,r.kt)("a",{parentName:"p",href:"/wiki/docs/getting-started/near-token/token-custody#option-1-ledger-via-cli"},"here"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up"),"  "),(0,r.kt)("p",{parentName:"blockquote"}," Signing a transaction with the wrong Ledger key can help associating multiple accounts of a user, since even failed transactions are recorded to the blockchain and can be subsequently analyzed. ")),(0,r.kt)("h2",{id:"1-lockup-contracts-delegation"},"1. Lockup Contracts Delegation"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near/core-contracts/tree/master/lockup"},"Lockup Contract")," is common among NEAR contributors and, essentially, anyone who didn't acquire tokens through an exchange. This contract acts as an escrow that locks and holds an owner's tokens for a lockup period ","(","such as vesting",")",". You can learn more about lockups and their implementation in the ",(0,r.kt)("a",{parentName:"p",href:"/wiki/docs/getting-started/near-token/lockups"},"this documentation page"),"."),(0,r.kt)("p",null,"The owner may want to stake these tokens ","(","including locked ones",")"," to help secure the network and also earn staking rewards that are distributed to the validator. The lockup contract doesn't allow to directly stake from its account, so the owner delegates the tokens using the contract built-in functions."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"heads up"),"  "),(0,r.kt)("p",{parentName:"blockquote"}," The commands below are tested with ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near/core-contracts/tree/877e2db699a02b81fc46f5034642a2ebd06d9f19"},"build 877e2db")," of the Core Contracts."),(0,r.kt)("p",{parentName:"blockquote"},"They also use formatting only available on Linux/macOS/Unix. If you are using Windows, you will need to replace dollar variables, ",(0,r.kt)("inlineCode",{parentName:"p"},"$LOCKUP_ID"),", with percent variables, ",(0,r.kt)("inlineCode",{parentName:"p"},"%LOCKUP_ID%"),". And you will need to use all double quotes, so things like ",(0,r.kt)("inlineCode",{parentName:"p"},"'{\"account_id\": \"'$ACCOUNT_ID'\"}'")," become ",(0,r.kt)("inlineCode",{parentName:"p"},'"{\\"account_id\\": \\"%ACCOUNT_ID%\\"}\\"'),".")),(0,r.kt)("p",null,"Before proceeding with the tutorial below, check that you have control of your lockup contract, by issuing the command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near view $LOCKUP_ID get_owner_account_id ''\n")),(0,r.kt)("p",null,"You should expect a result like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"$ near view meerkat.stakewars.testnet get_owner_account_id ''\nView call: meerkat.stakewars.testnet.get_owner_account_id()\n'meerkat.testnet'\n")),(0,r.kt)("p",null,"Note that this example us using ",(0,r.kt)("inlineCode",{parentName:"p"},"NEAR_ENV=testnet")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"$LOCKUP_ID")," set to ",(0,r.kt)("inlineCode",{parentName:"p"},"meerkat.stakewars.testnet")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"ACCOUNT_ID")," set to ",(0,r.kt)("inlineCode",{parentName:"p"},"meerkat.testnet"),", which matches the returned result above."),(0,r.kt)("p",null,"You can stake with Lockup contracts in three steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Set up the staking pool"),(0,r.kt)("li",{parentName:"ol"},"Deposit and stake the tokens"),(0,r.kt)("li",{parentName:"ol"},"Measure the rewards")),(0,r.kt)("h3",{id:"a-set-the-staking-pool"},"a. Set the staking pool"),(0,r.kt)("p",null,"Lockup contracts can stake ",(0,r.kt)("strong",{parentName:"p"},"to one staking pool at a time"),", so this parameter can be changed only while no funds are staked."),(0,r.kt)("p",null,"You can select the staking pool by calling the method ",(0,r.kt)("inlineCode",{parentName:"p"},"select_staking_pool")," from the lockup contract:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID select_staking_pool '{\n  \"staking_pool_account_id\": \"'$POOL_ID'\"\n}' --accountId $ACCOUNT_ID\n")),(0,r.kt)("p",null,"If using a Ledger:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID select_staking_pool '{\n  \"staking_pool_account_id\": \"'$POOL_ID'\"\n}' --accountId $ACCOUNT_ID --useLedgerKey $HD_PATH\n")),(0,r.kt)("p",null,"You should expect a result like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'Scheduling a call: meerkat.stakewars.testnet.select_staking_pool({"staking_pool_account_id": "zpool.pool.f863973.m0"})\nReceipts: HEATt32tHqWdjkZoSxLhd43CYVBCUp1cFHexgWBEeKJg, EUP7tncJfKDPpKYdunx2qySZ6JmV3injBigyFBiuD96J, 99hdXWmaTQE7gR5vucxMWFNMw7ZLtzJ6WNMSVJHPGJxh\n    Log [meerkat.stakewars.testnet]: Selecting staking pool @zpool.pool.f863973.m0. Going to check whitelist first.\nTransaction Id 4Z2t1SeN2rdbJcPvfVGScpwyuGGKobZjT3eqvDu28sBk\nTo see the transaction in the transaction explorer, please open this url in your browser\nhttps://explorer.testnet.near.org/transactions/4Z2t1SeN2rdbJcPvfVGScpwyuGGKobZjT3eqvDu28sBk\ntrue\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," statement means that your call was successful, and the lockup contract accepted the ",(0,r.kt)("inlineCode",{parentName:"p"},"$POOL_ID")," parameter."),(0,r.kt)("h3",{id:"b-deposit-and-stake-the-tokens"},"b. Deposit and stake the tokens"),(0,r.kt)("p",null,"Lockup contracts can stake their balance, regardless of their vesting schedule. You can proceed in two steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"check the lockup balance"),(0,r.kt)("li",{parentName:"ol"},"stake the balance"),(0,r.kt)("li",{parentName:"ol"},"To know how many tokens you can stake, use the view method ",(0,r.kt)("inlineCode",{parentName:"li"},"get_balance"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"near view $LOCKUP_ID get_balance ''\n")),(0,r.kt)("p",null,"You should expect a result like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"$ near view meerkat.stakewars.testnet get_balance ''\nView call: meerkat.stakewars.testnet.get_balance()\n'100000499656128234500000000'\n")),(0,r.kt)("p",null,"Where the resulting balance ","(","in ",(0,r.kt)("a",{parentName:"p",href:"https://www.nist.gov/pml/weights-and-measures/metric-si-prefixes"},"yocto"),"NEAR",")"," is ",(0,r.kt)("inlineCode",{parentName:"p"},"100000499656128234500000000")," or 100 $NEAR."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"heads up"),"  "),(0,r.kt)("p",{parentName:"blockquote"}," You have to leave 35 $NEAR in the lockup contract for the storage fees. If you have 100 tokens, you can stake up to 65 tokens. If you have 1000 tokens, you can stake up to 965 tokens."),(0,r.kt)("p",{parentName:"blockquote"},"You may want to ",(0,r.kt)("inlineCode",{parentName:"p"},"npm i -g near-units")," to easily convert yoctoNEAR amounts to human-readable representations, and to go from human-typeable numbers to yoctoNEAR. Examples:"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near-units -h 100000499656128234500000000 yN\nnear-units 965 N\n")),(0,r.kt)("p",{parentName:"blockquote"},"On Linux/macOS/Unix, you can also use this directly in the following commands:"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID deposit_and_stake '{\n  \"amount\": \"'$(near-units 965N)'\"\n}' --accountId $ACCOUNT_ID --gas $(near-units 200Tgas)\n"))),(0,r.kt)("p",null,"You may want to set your desired amount-to-stake to a variable:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"export AMOUNT=# your desired amount to stake\n")),(0,r.kt)("p",null,"To stake the balance, use the call method ",(0,r.kt)("inlineCode",{parentName:"p"},"deposit_and_stake"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID deposit_and_stake '{\n  \"amount\": \"'$AMOUNT'\"\n}' --accountId $ACCOUNT_ID --gas 200000000000000\n")),(0,r.kt)("p",null,"If using a Ledger:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID deposit_and_stake '{\n  \"amount\": \"'$AMOUNT'\"\n}' --accountId $ACCOUNT_ID --gas 200000000000000 --useLedgerKey $HD_PATH \n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up"),"  "),(0,r.kt)("p",{parentName:"blockquote"}," This sets the gas parameter to 200000000000000 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.near.org/docs/concepts/gas"},"gas units"),", or 200 Tgas (Teragas), as the near-cli default allocation of 30Tgas is too low.")),(0,r.kt)("p",null,"You should expect a result like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'Scheduling a call: meerkat.stakewars.testnet.deposit_and_stake({"amount": "65000000000000000000000000"})\nReceipts: BFJxgYMbPLpKy4jae3b5ZJfLuAmpcYCBG2oJniDgh1PA, 9sZSqdLvPXPzpRg9VLwaWjJaBUnXm42ntVCEK1UwmYTp, CMLdB4So6ZYPif8qq2s7zFvKw599HMBVcBfQg85AKNQm\n    Log [meerkat.stakewars.testnet]: Depositing and staking 65000000000000000000000000 to the staking pool @zpool.pool.f863973.m0\nReceipts: 3VpzWTG9Y2nbZmuJhmsub9bRLnwHCFtnW5NQqcMBWawF, 4BrEKDPmz3mAhnq5tTFYRQp8y9uRxGFwYffJFkPMdQ5P, HJPqqJDTajFfeEA8vFXTLDpxh4PYZCMJ2YLKpWVtwSMF\n    Log [meerkat.stakewars.testnet]: Epoch 105: Contract received total rewards of 20383576173536987339742291104 tokens. New total staked balance is 104251712242552700026473040909. Total number of shares 77295581098329153455984430997\n    Log [meerkat.stakewars.testnet]: Total rewards fee is 1511304065231935217653387665 stake shares.\n    Log [meerkat.stakewars.testnet]: @meerkat.stakewars.testnet deposited 65000000000000000000000000. New unstaked balance is 65000000000000000000000000\n    Log [meerkat.stakewars.testnet]: @meerkat.stakewars.testnet staking 64999999999999999999999999. Received 48193095953206307331949682 new staking shares. Total 1 unstaked balance and 48193095953206307331949682 staking shares\n    Log [meerkat.stakewars.testnet]: Contract total staked balance is 104316712242552700026473040909. Total number of shares 77343774194282359763316380679\nReceipt: FsJLXXEa8Jp8UNyiyG3XQhyHHSWzZ2bCjgWr8kPVjGmG\n    Log [meerkat.stakewars.testnet]: The deposit and stake of 65000000000000000000000000 to @zpool.pool.f863973.m0 succeeded\nTransaction Id AW9pFb5RjkCjsyu8ng56XVvckvd3drPBPtnqVo6bJhqh\nTo see the transaction in the transaction explorer, please open this url in your browser\nhttps://explorer.testnet.near.org/transactions/AW9pFb5RjkCjsyu8ng56XVvckvd3drPBPtnqVo6bJhqh\ntrue\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," statement at the end means the transaction was successful."),(0,r.kt)("h3",{id:"c-measure-the-rewards"},"c. Measure the rewards"),(0,r.kt)("p",null,"Since NEAR automatically re-stakes all staking pool rewards, you have to update your staked balance to know the amount of tokens you earned with your validator."),(0,r.kt)("p",null,"Use the call method ",(0,r.kt)("inlineCode",{parentName:"p"},"refresh_staking_pool_balance")," to check your new balance:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID refresh_staking_pool_balance '' \\\n  --accountId $ACCOUNT_ID\n")),(0,r.kt)("p",null,"If using a Ledger:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID refresh_staking_pool_balance '' \\\n  --accountId $ACCOUNT_ID --useLedgerKey $HD_PATH\n")),(0,r.kt)("p",null,"You should expect a result like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"$ near call $LOCKUP_ID refresh_staking_pool_balance '' \\\n  --accountId $ACCOUNT_ID | grep \"current total balance\"\n    Log [meerkat.stakewars.testnet]: The current total balance on the staking pool is 65000000000000000000000000\n")),(0,r.kt)("p",null,"Note that in this example, the result is piped to ",(0,r.kt)("a",{parentName:"p",href:"https://www.tutorialspoint.com/unix_commands/grep.htm"},"grep")," (",(0,r.kt)("inlineCode",{parentName:"p"},'| grep "current total balance"'),") to display only the relevant output."),(0,r.kt)("p",null,"Please refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near/core-contracts/tree/master/lockup"},"Lockup Contract readme")," if you need to know how to withdraw the staking rewards to your main wallet."),(0,r.kt)("h2",{id:"unstake-and-withdraw-your-lockup-tokens"},"Unstake and withdraw your lockup tokens"),(0,r.kt)("p",null,"NEAR Protocol automatically re-stakes all the rewards back to the staking pools, so your staked balance increases over time, accruing rewards."),(0,r.kt)("p",null,"Before starting, it's highly recommended to read the ",(0,r.kt)("a",{parentName:"p",href:"/wiki/docs/getting-started/near-token/lockups"},"Lockup contracts documentation")," to understand which portion of the tokens is liquid, and which one is still ",(0,r.kt)("em",{parentName:"p"},"locked")," even after the three epochs."),(0,r.kt)("p",null,"If you want to withdraw funds, you have to issue two separate commands:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Manually unstake tokens from the staking pool, and wait three epochs"),(0,r.kt)("li",{parentName:"ol"},"Manually withdraw tokens back to your main account")),(0,r.kt)("p",null,"Both these command require the amount in yoctoNEAR, which is the smallest unit of account for NEAR tokens. You can use the table below for the conversion, or install ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/near-units"},"near-units")," (",(0,r.kt)("inlineCode",{parentName:"p"},"npm i -g near-units"),") and use commands like ",(0,r.kt)("inlineCode",{parentName:"p"},"near-units 1,000N"),":"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"NEAR"),(0,r.kt)("th",{parentName:"tr",align:"left"},"YoctoNEAR"),(0,r.kt)("th",{parentName:"tr",align:"left"},"YoctoNEAR"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"1")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"1*10^24")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"1000000000000000000000000"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"10")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"1*10^25")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"10000000000000000000000000"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"100")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"1*10^26")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"100000000000000000000000000"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"1,000")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"1*10^27")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"1000000000000000000000000000"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"10,000")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"1*10^28")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"10000000000000000000000000000"))))),(0,r.kt)("p",null,"As an example, if you want to unstake ",(0,r.kt)("inlineCode",{parentName:"p"},"10")," NEAR tokens from the staking pool, you have to call the method ",(0,r.kt)("inlineCode",{parentName:"p"},"unstake")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"10000000000000000000000000")," ","(",(0,r.kt)("inlineCode",{parentName:"p"},"1*10^24"),", 10 power 24, or 10 with 24 zeros",")"," as an argument."),(0,r.kt)("h3",{id:"a-unstake-the-tokens"},"a. Unstake the tokens"),(0,r.kt)("p",null,"Before unstaking any tokens, use the the view method ",(0,r.kt)("inlineCode",{parentName:"p"},"get_account")," introduced above to know what is the available balance:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"near view $POOL_ID get_account '{\"account_id\": \"'$LOCKUP_ID'\"}'\n")),(0,r.kt)("p",null,"You should expect a result like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"$ near view zpool.pool.f863973.m0 get_account '{\"account_id\": \"meerkat.stakewars.testnet\"}'\nView call: zpool.pool.f863973.m0.get_account({\"account_id\": \"meerkat.stakewars.testnet\"})\n{\n  account_id: 'meerkat.stakewars.testnet',\n  unstaked_balance: '5',\n  staked_balance: '86236099167204810592552675',\n  can_withdraw: false\n}\n")),(0,r.kt)("p",null,"The result of this method shows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"An unstaked balance of ",(0,r.kt)("inlineCode",{parentName:"li"},"5")," ",(0,r.kt)("em",{parentName:"li"},"yocto")),(0,r.kt)("li",{parentName:"ul"},"A staked balance of ",(0,r.kt)("inlineCode",{parentName:"li"},"86236099167204810592552675")," ",(0,r.kt)("em",{parentName:"li"},"yocto"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"86.23")," $NEAR"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"can_withdraw")," is ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," ","(","see below",")")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Check your rewards"),"  "),(0,r.kt)("p",{parentName:"blockquote"}," From the examples above, the initial stake of 65 NEAR tokens increased to 86.23 tokens, with 21.23 tokens as a reward!")),(0,r.kt)("p",null,"You can unstake an amount of funds that is equal or lower than your ",(0,r.kt)("inlineCode",{parentName:"p"},"staked_balance"),", by calling the metod ",(0,r.kt)("inlineCode",{parentName:"p"},"unstake"),". You may first want to set the amount you want to unstake to a variable ",(0,r.kt)("inlineCode",{parentName:"p"},"AMOUNT"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export AMOUNT=# amount to unstake\n")),(0,r.kt)("p",null,"Check that it looks correct:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"echo $AMOUNT\n")),(0,r.kt)("p",null,"And maybe also using ",(0,r.kt)("inlineCode",{parentName:"p"},"near-units"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near-units -h $AMOUNT yN\n")),(0,r.kt)("p",null,"And now unstake:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID unstake '{\n  \"amount\": \"'$AMOUNT'\"\n}' --accountId $ACCOUNT_ID --gas 200000000000000\n")),(0,r.kt)("p",null,"Or with a Ledger:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID unstake '{\n  \"amount\": \"'$AMOUNT'\"\n}' --accountId $ACCOUNT_ID --gas 200000000000000 --useLedgerKey $HD_PATH\n")),(0,r.kt)("p",null,"You should expect a result like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'Scheduling a call: meerkat.stakewars.testnet.unstake({"amount": "42000000000000000000000000"})\nWaiting for confirmation on Ledger...\nUsing public key: ed25519:5JgsX9jWUTS5ttHeTjuDFgCmB5YX77f7GHxuQfaGVsyj\nWaiting for confirmation on Ledger...\nLedger app version: 1.1.3\nReceipts: D5fCCWa5b5N8X9VtxsbRvGhSSCQc56Jb312DEbG4YY8Z, 72rgHrMb1zkUU2RiEz2EMCAuMWFgRJTf8eovwAUkuo31, A2dvSgxpDXfNZUrDVdpewk1orVTVxCMiicjk7qyNq3dW\n    Log [meerkat.stakewars.testnet]: Unstaking 42000000000000000000000000 from the staking pool @zpool.pool.f863973.m0\nReceipts: 9MbLXn28nQyL6BopMEUggBD9NA1QfVio9VB3LTNJ6P5b, 5g7F6HehoGZ2DHS7w54xHAjAeHCsHaAsKpVed76MFYru, BKbtF77i1WEqpuFLtEjWerM2LVZW1md9ecQ5UcBpMNXj\n    Log [meerkat.stakewars.testnet]: Epoch 162: Contract received total rewards of 9488161121527521670023204339 tokens. New total staked balance is 142388816229749953331375665038. Total number of shares 79574075700231185032355056920\n    Log [meerkat.stakewars.testnet]: Total rewards fee is 530246455678218748147822292 stake shares.\n    Log [meerkat.stakewars.testnet]: @meerkat.stakewars.testnet unstaking 42000000000000000000000001. Spent 23471725293488513736732361 staking shares. Total 42000000000000000000000002 unstaked balance and 24721370659717793595217321 staking shares\n    Log [meerkat.stakewars.testnet]: Contract total staked balance is 142346816229749953331375665038. Total number of shares 79550603974937696518618324559\nReceipt: 3DXSx8aMvhwtJUB6mhTueNbDiqz5wYu3xzzYkZrgjw1u\n    Log [meerkat.stakewars.testnet]: Unstaking of 42000000000000000000000000 at @zpool.pool.f863973.m0 succeeded\nTransaction Id 2rRpdN8AAoySfWsgE7BRtRfz7VFnyFzRhssfaL87rXGf\nTo see the transaction in the transaction explorer, please open this url in your browser\nhttps://explorer.testnet.near.org/transactions/2rRpdN8AAoySfWsgE7BRtRfz7VFnyFzRhssfaL87rXGf\ntrue\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," statement at the end means the transaction was successful."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Wait three epochs, or ~36 hours before using the withdraw command")),(0,r.kt)("p",null,"For security reasons, NEAR Protocol keeps your unstaked funds locked for three more epochs ","(","~36 hours",")",". Use again the view method ",(0,r.kt)("inlineCode",{parentName:"p"},"get_account")," to verify if ",(0,r.kt)("inlineCode",{parentName:"p"},"can_withdraw")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"near view $POOL_ID get_account '{\"account_id\": \"'$LOCKUP_ID'\"}'\n")),(0,r.kt)("p",null,"The result should be as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"View call: zpool.pool.f863973.m0.get_account({\"account_id\": \"meerkat.stakewars.testnet\"})\n{\n  account_id: 'meerkat.stakewars.testnet',\n  unstaked_balance: '42000000000000000000000006',\n  staked_balance: '44244760537191121230392104',\n  can_withdraw: true\n}\n")),(0,r.kt)("p",null,"Note that the variable ",(0,r.kt)("inlineCode",{parentName:"p"},"can_withdraw")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),". This means that the ",(0,r.kt)("inlineCode",{parentName:"p"},"unstaked_balance")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"42000000000000000000000000")," yoctoNEAR ","(","42 NEAR tokens",")"," is now available for withdraw."),(0,r.kt)("h3",{id:"b-withdraw-the-tokens"},"b. Withdraw the tokens"),(0,r.kt)("p",null,"Funds can be withdrawn after three epochs ","(","~36 hours",")"," from the ",(0,r.kt)("inlineCode",{parentName:"p"},"unstake")," command. It is highly recommended to read the ",(0,r.kt)("a",{parentName:"p",href:"/wiki/docs/getting-started/near-token/lockups"},"Lockup contracts documentation")," to understand which portion of the unstaked tokens is available for transfers, and which is still vesting and unavailable ","(","even after three epochs",")","."),(0,r.kt)("p",null,"Use the call method ",(0,r.kt)("inlineCode",{parentName:"p"},"withdraw_all_from_staking_pool"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID withdraw_all_from_staking_pool '' --accountId $ACCOUNT_ID --gas 200000000000000\n")),(0,r.kt)("p",null,"Or if using a Ledger:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID withdraw_all_from_staking_pool '' --accountId $ACCOUNT_ID --gas 200000000000000 --useLedgerKey $HD_PATH\n")),(0,r.kt)("p",null,"You should expect a result like this one:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Scheduling a call: meerkat.stakewars.testnet.withdraw_all_from_staking_pool()\nWaiting for confirmation on Ledger...\nUsing public key: ed25519:5JgsX9jWUTS5ttHeTjuDFgCmB5YX77f7GHxuQfaGVsyj\nWaiting for confirmation on Ledger...\nLedger app version: 1.1.3\nReceipts: 6dt3HNDrb7jM4F7cRtwgRSfRMWwFmE8BHeZSDghrpQtw, 7pNKTevct7Z4birAPec81LmnSpJSeJXbFq3cBdjFvsnM, A7yJXdaGcFyiBNQimFtHF479Jm6xiXHvfodTbtFf7Rww\n    Log [meerkat.stakewars.testnet]: Going to query the unstaked balance at the staking pool @zpool.pool.f863973.m0\nReceipts: 2ytgB57D6CJe3vkxdVTiVAytygpTteR4sDmpUNxo5Ltk, CZChcT1uDDxqojnZQq6r7zzx6FE3Z6E5fZ3F23Y1dnyM, GjrWhJgbCAAHUNyvw4QX5YKFpeUVNJ9GpuEdmUXFozeG\n    Log [meerkat.stakewars.testnet]: Withdrawing 42000000000000000000000006 from the staking pool @zpool.pool.f863973.m0\nReceipts: 9nHoqnQygqKYyyR5KDofkYy5KiJxbu2eymoGUUc2tSR3, 5RvBSb4BuHxRhc5U6nLgsCjAvJ88hJ2jwkr1ramk37mE, 5PDN1EYXnCJrTSU7zzJtmAuj9vvGSVurh94nvfHDHXpa, GTTGm4sXcSWD2gnohMJzD7TQcQxuSe7AFABZKqxPLgau\n    Log [meerkat.stakewars.testnet]: Epoch 168: Contract received total rewards of 514182787298700000000 tokens. New total staked balance is 142377784876419564057032272059. Total number of shares 79552334320822393318832070510\n    Log [meerkat.stakewars.testnet]: Total rewards fee is 28729510739826825657 stake shares.\n    Log [meerkat.stakewars.testnet]: @meerkat.stakewars.testnet withdrawing 42000000000000000000000006. New unstaked balance is 0\nReceipt: rS5KjvzkbaxEH7aG8VXyd9EEEfY7PygdLzSZ3W9qf3w\n    Log [meerkat.stakewars.testnet]: The withdrawal of 42000000000000000000000006 from @zpool.pool.f863973.m0 succeeded\nTransaction Id EjNpoU7BNfEQujckL8JiAP8kYDH1SMLw4wC32tL3uyaH\nTo see the transaction in the transaction explorer, please open this url in your browser\nhttps://explorer.testnet.near.org/transactions/EjNpoU7BNfEQujckL8JiAP8kYDH1SMLw4wC32tL3uyaH\ntrue\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," statement confirms the successful withdrawal."),(0,r.kt)("p",null,"By using again the view method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near view $POOL_ID get_account '{\"account_id\": \"'$LOCKUP_ID'\"}'\n")),(0,r.kt)("p",null,"The result should be as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"View call: zpool.pool.f863973.m0.get_account({\"account_id\": \"meerkat.stakewars.testnet\"})\n{\n  account_id: 'meerkat.stakewars.testnet',\n  unstaked_balance: '0',\n  staked_balance: '44244760947075774431066852',\n  can_withdraw: true\n}\n")),(0,r.kt)("p",null,"At this point the ",(0,r.kt)("inlineCode",{parentName:"p"},"unstaked_balance")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"0"),", and the funds are back in the lockup contract balance."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up"),"  "),(0,r.kt)("p",{parentName:"blockquote"}," Lockup contracts allow you to transfer only the unlocked portion of your funds. In the example above, out of the 42 NEAR unstaked, only 21.23 can be transferred to another wallet or exchange.")),(0,r.kt)("h3",{id:"c-change-staking-pools"},"c. Change staking pools"),(0,r.kt)("p",null,"To change from one staking pool to another, you must first withdraw all deposits in the currently selected staking pool. Then call ",(0,r.kt)("inlineCode",{parentName:"p"},"unselect_staking_pool")," as follows ","(",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near/core-contracts/blob/215d4ed2edb563c47edd961555106b74275c4274/lockup/README.md"},"docs"),")",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID unselect_staking_pool --accountId $ACCOUNT_ID --gas 300000000000000\n")),(0,r.kt)("p",null,"Or if using Ledger:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $LOCKUP_ID unselect_staking_pool --accountId $ACCOUNT_ID --useLedgerKey $HD_PATH --gas 300000000000000\n")),(0,r.kt)("h2",{id:"staking-pool-delegation"},"Staking Pool Delegation"),(0,r.kt)("p",null,"Any funds that are not stored inside lockup contracts can be directly delegated to a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near/core-contracts/tree/master/staking-pool"},"staking pool")," by using the call method ",(0,r.kt)("inlineCode",{parentName:"p"},"deposit_and_stake"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $POOL_ID deposit_and_stake '' --accountId $ACCOUNT_ID --amount 100\n")),(0,r.kt)("p",null,"Or if using Ledger:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $POOL_ID deposit_and_stake '' --accountId $ACCOUNT_ID --useLedgerKey $HD_PATH --amount 100\n")),(0,r.kt)("p",null,"You should expect a result like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Scheduling a call: valeraverim.pool.f863973.m0.deposit_and_stake() with attached 100 NEAR\nReceipts: FEfNuuCSttu7m4dKQPUSgpSFJSB86i6T2sYJWSv7PHPJ, GPYhZsyUuJgvr7gefxac4566DVQcyGs4wSFeydkmRX7D, 8hfcJuwsstnFQ1cgU5iUigvfrq1JcbaKURvKf5shaB4g\n    Log [valeraverim.pool.f863973.m0]: Epoch 106: Contract received total rewards of 545371217890000000000 tokens. New total staked balance is 75030000959768421358700000000. Total number of shares 75029067713856889417103116457\n    Log [valeraverim.pool.f863973.m0]: Total rewards fee is 54536443439735902364 stake shares.\n    Log [valeraverim.pool.f863973.m0]: @meerkat.testnet deposited 100000000000000000000000000. New unstaked balance is 100000000000000000000000000\n    Log [valeraverim.pool.f863973.m0]: @meerkat.testnet staking 99999999999999999999999999. Received 99998756169666008195607157 new staking shares. Total 1 unstaked balance and 99998756169666008195607157 staking shares\n    Log [valeraverim.pool.f863973.m0]: Contract total staked balance is 75130000959768421358700000000. Total number of shares 75129066470026555425298723614\nTransaction Id FDtzMmusJgFbryeVrdQyNvp6XU2xr11tecgqnnSsvyxv\nTo see the transaction in the transaction explorer, please open this url in your browser\nhttps://explorer.testnet.near.org/transactions/FDtzMmusJgFbryeVrdQyNvp6XU2xr11tecgqnnSsvyxv\n''\n")),(0,r.kt)("p",null,"The empty string at the end, ",(0,r.kt)("inlineCode",{parentName:"p"},"''"),", means the call was successful."),(0,r.kt)("p",null,"If you want to check your staking rewards, use the view method ",(0,r.kt)("inlineCode",{parentName:"p"},"get_account"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near view $POOL_ID get_account '{\"account_id\": \"'$ACCOUNT_ID'\"}'\n")),(0,r.kt)("p",null,"You should expect a result like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"View call: valeraverim.pool.f863973.m0.get_account({\"account_id\": \"meerkat.testnet\"})\n{\n  account_id: 'meerkat.testnet',\n  unstaked_balance: '1',\n  staked_balance: '100663740438210643632989745',\n  can_withdraw: true\n}\n")),(0,r.kt)("p",null,"The staked balance in this example is ",(0,r.kt)("inlineCode",{parentName:"p"},"100663740438210643632989745"),", or ",(0,r.kt)("inlineCode",{parentName:"p"},"100.66")," $NEAR (reminder: you can easily convert these using ",(0,r.kt)("inlineCode",{parentName:"p"},"near-units -h 100663740438210643632989745yN"),")."),(0,r.kt)("p",null,'A pool\'s rewards only compound if it has been "pinged", which means either having a direct action performed on it ',"(","like someone delegating or undelegating",")"," or if the ",(0,r.kt)("inlineCode",{parentName:"p"},"ping")," method is called on it once within a particular epoch. This is important to do if you run a pool and want your delegators to see updated reward balances."),(0,r.kt)("p",null,"Use the call method ",(0,r.kt)("inlineCode",{parentName:"p"},"ping")," to re-calculate the rewards up to the previous epoch:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $POOL_ID ping '{}' --accountId $ACCOUNT_ID\n")),(0,r.kt)("p",null,"Or if using a Ledger:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near call $POOL_ID ping '{}' --accountId $ACCOUNT_ID --useLedgerKey $HD_PATH\n")),(0,r.kt)("p",null,"You should expect a result like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Scheduling a call: valeraverim.pool.f863973.m0.ping({})\nTransaction Id 4mTrz1hDBMTWZx251tX4M5CAo5j7LaxLiPtQrDvQgcZ9\nTo see the transaction in the transaction explorer, please open this url in your browser\nhttps://explorer.testnet.near.org/transactions/4mTrz1hDBMTWZx251tX4M5CAo5j7LaxLiPtQrDvQgcZ9\n''\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"''")," result means that your call was successful, and the ",(0,r.kt)("inlineCode",{parentName:"p"},"get_account")," view method will provide updated results."),(0,r.kt)("p",null,"Note that you can ping any pool, not just one you own."),(0,r.kt)("h2",{id:"additional-links"},"Additional links"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/wiki/docs/getting-started/near-token/lockups"},"Lockup contracts explained")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/near/core-contracts"},"NEAR Core Contracts on Github")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://explorer.near.org"},"NEAR block explorer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/near/near-cli"},"near-cli on Github"))),(0,r.kt)("h2",{id:"fun-facts"},"Fun Facts"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"ping"),"ing a pool technically removes 2 epochs of future compounding but it's an extremely small amount -- without considering compounding effect of epochs with 9 hour epochs, the reward per epoch is 5% / ","(","365 ","*"," 24 / 9",")"," + 1 or 1.00005136986"),(0,r.kt)("p",{parentName:"li"},"It means this reward on top of reward is what you\u2019re losing, so that's about 1.00000000264 or 0.000000264%... meaning for 10M stake it\u2019s 0.02638862826 NEAR per epoch."))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Got a question? "),(0,r.kt)("p",{parentName:"blockquote"},"Ask it on ",(0,r.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/tagged/nearprotocol"},"StackOverflow!"))))}u.isMDXComponent=!0}}]);